## 通知

Android 的通知系统是一种用于在应用程序以外的位置通知用户的重要信息的方式。通知可以是声音、图标、振动、弹窗、LED灯等，通知可以显示在锁屏上、通知中心、状态栏、悬浮窗等。

以下是一些与 Android 通知相关的知识点：

1. **通知的组成**：
   - **Icon**: 通知的图标。
   - **Title**: 通知的标题。
   - **Text**: 通知的内容。
   - **Priority**: 通知的优先级。
   - **Actions**: 通知的操作，比如可以在通知上添加按钮，当用户点击按钮时可以触发某些操作。



1. **通知频道** (Notification Channels): 从 Android O（8.0）开始，所有的通知都必须分配到一个通知频道。通知频道是一种你可以向用户展示的用户可自定义通知的方法。
2. **通知样式**: 你可以自定义通知的样式，例如展示大图片、多行文字等。你可以使用 `NotificationCompat.BigTextStyle` 或 `NotificationCompat.BigPictureStyle` 等。
3. **通知操作**: 可以在通知上添加操作按钮，当用户点击这个按钮时可以触发某些操作。
4. **通知优先级和打断模式**: 可以设置通知的优先级，从而影响通知的展示方式。
5. **进度指示器**: 通知上可以显示进度指示器，这对于展示一个后台任务的进度很有用。
6. **全局的通知设置**: 可以在设置中全局设置通知的行为，例如是否允许通知显示、是否允许通知震动等。

​			

通知的示例

```java
package com.open.notifygo;

import androidx.appcompat.app.AppCompatActivity;
import androidx.core.app.ActivityCompat;
import androidx.core.app.NotificationCompat;
import androidx.core.app.NotificationManagerCompat;

import android.app.NotificationChannel;
import android.app.NotificationManager;
import android.content.pm.PackageManager;
import android.os.Build;
import android.os.Bundle;
import android.widget.TextView;

import com.open.notifygo.databinding.ActivityMainBinding;

public class MainActivity extends AppCompatActivity {

    private static final String CHANNEL_ID = "channel_id";
    private static final int NOTIFICATION_ID = 1;


    // Used to load the 'notifygo' library on application startup.
    static {
        System.loadLibrary("notifygo");
    }

    private ActivityMainBinding binding;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        binding = ActivityMainBinding.inflate(getLayoutInflater());
        setContentView(binding.getRoot());

        // Example of a call to a native method
        TextView tv = binding.sampleText;
        tv.setText(stringFromJNI());

        createNotificationChannel();

        NotificationCompat.Builder builder = new NotificationCompat.Builder(this, CHANNEL_ID)
                .setSmallIcon(R.drawable.ic_launcher_foreground)
                .setContentTitle("Sample Notification")
                .setContentText("This is a sample notification")
                .setPriority(NotificationCompat.PRIORITY_DEFAULT);

        NotificationManagerCompat notificationManager = NotificationManagerCompat.from(this);
        if (ActivityCompat.checkSelfPermission(this, android.Manifest.permission.POST_NOTIFICATIONS) != PackageManager.PERMISSION_GRANTED) {
            return;
        }
        notificationManager.notify(NOTIFICATION_ID, builder.build());
    }

    /**
     * A native method that is implemented by the 'notifygo' native library,
     * which is packaged with this application.
     */
    public native String stringFromJNI();
    private void createNotificationChannel() {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
            CharSequence name = "Sample Channel";
            String description = "This is a sample notification channel";
            int importance = NotificationManager.IMPORTANCE_DEFAULT;
            NotificationChannel channel = new NotificationChannel(CHANNEL_ID, name, importance);
            channel.setDescription(description);
            NotificationManager notificationManager = getSystemService(NotificationManager.class);
            notificationManager.createNotificationChannel(channel);
        }
    }
}
```



分析代码

用于创建 `Notification` 对象

```java
        NotificationCompat.Builder builder = new NotificationCompat.Builder(this, CHANNEL_ID)
                .setSmallIcon(R.drawable.ic_launcher_foreground)
                .setContentTitle("Sample Notification")
                .setContentText("This is a sample notification")
                .setPriority(NotificationCompat.PRIORITY_DEFAULT);
```

1. `NotificationCompat.Builder(this, CHANNEL_ID)`：这将创建一个 `NotificationCompat.Builder` 对象。构造函数需要两个参数：
   - `this`: 这是上下文。
   - `CHANNEL_ID`: 这是通知渠道的 ID。通知将发送到这个通知渠道。
2. `setSmallIcon(R.drawable.ic_launcher_foreground)`：这将设置通知的小图标。这是必需的。
3. `setContentTitle("Sample Notification")`：这将设置通知的标题。
4. `setContentText("This is a sample notification")`：这将设置通知的文本。
5. `setPriority(NotificationCompat.PRIORITY_DEFAULT)`：这将设置通知的优先级。这将决定通知的显示方式。例如，`PRIORITY_DEFAULT` 将使通知以正常方式显示。（**Android8**之后的优先级就不是在这个地方进行设置的了，是在通知的渠道当中设置的，这里设置没有用，也可以直接删了）

​							

后面的我们都很好理解，我们来看看这个，CHANNEL_ID，这是一个什么东西

假设你有一个新闻应用程序，这个应用程序发送两种类型的通知：一种是重要的新闻更新（例如，突发新闻），另一种是次要的新闻更新（例如，娱乐新闻）。

在这种情况下，你可以创建两个通知渠道：

1. 一个用于重要的新闻更新。你可以为这个通知渠道设置一个高的重要性级别，这将使这些通知在用户的设备上更加突出。
2. 另一个用于次要的新闻更新。你可以为这个通知渠道设置一个低的重要性级别，这将使这些通知在用户的设备上不那么突出。

在 **Android 8.0**没有通知渠道之前，我们是，每一个通知都要单独的，设置他们的各个属性，并且程序一旦设置了，就没有办法修改。

​					

通知渠道可以用于管理应用程序的以下通知设置：（简单来说就是通知的各种属性）

1. **重要性**：这将决定通知的显示方式。例如，高重要性的通知可能会以对话框的形式显示，而低重要性的通知可能只会在通知栏中显示。
2. **声音**：这将决定通知的声音。
3. **振动**：这将决定通知是否会使设备振动。
4. **指示灯**：这将决定通知是否会使设备的指示灯闪烁。
5. **锁屏显示**：这将决定通知是否在锁屏上显示。
6. **显示角标**：这将决定通知是否显示应用程序图标上的角标。
7. **优先级**：这将决定通知在通知栏中的位置。高优先级的通知将显示在通知栏的顶部，而低优先级的通知将显示在通知栏的底部。
8. **干扰**：这将决定通知是否会干扰用户。例如，你可以设置一个通知渠道为“紧急”级别，这将使通知播放声音，并显示为一个弹出的对话框。

​			

我们看看设置渠道的代码

```java
    private void createNotificationChannel() {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
            CharSequence name = "Sample Channel";
            String description = "This is a sample notification channel";
            int importance = NotificationManager.IMPORTANCE_UNSPECIFIED;
            NotificationChannel channel = new NotificationChannel(CHANNEL_ID, name, importance);
            channel.setDescription(description);
            NotificationManagerCompat notificationManager = NotificationManagerCompat.from(this);
            notificationManager.createNotificationChannel(channel);
        }
    }
```

1. `if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {`: 这行代码检查设备的 Android 版本是否是 8.0 或更高。因为通知渠道是在 Android 8.0 中引入的，所以只有在 Android 8.0 或更高版本的设备上才需要创建通知渠道。
2. `CharSequence name = "Sample Channel";`: 这行代码定义了通知渠道的名字。这个名字是用户可读的，会显示在设备的设置中。
3. `String description = "This is a sample notification channel";`: 这行代码定义了通知渠道的描述。这个描述也是用户可读的，会显示在设备的设置中。
4. `int importance = NotificationManager.IMPORTANCE_UNSPECIFIED;`: 这行代码定义了通知渠道的重要性。这个重要性会影响通知的显示方式。例如，高重要性的通知会显示在屏幕的顶部，并且可能会发出声音。
5. `NotificationChannel channel = new NotificationChannel(CHANNEL_ID, name, importance);`: 这行代码创建了一个新的 `NotificationChannel` 对象。这个对象需要三个参数：通知渠道的 ID、名字和重要性。
6. `channel.setDescription(description);`: 这行代码设置了通知渠道的描述。
7. `NotificationManagerCompat notificationManager = NotificationManagerCompat.from(this);`: 这行代码获取了 `NotificationManager` 服务。这个服务用于管理所有的通知。
8. `notificationManager.createNotificationChannel(channel);`: 这行代码使用 `NotificationManager` 服务创建了通知渠道。

​				

简单来说，就是，一个通知的创建，到发送，大致可以分为三个部分

1. 创建一个通知的渠道，在这个里面确定通知的属性，比方说优先级，通知的声音，通知的震动等等。
2. 创建一个通知的 builder 属性，比方说，通知的内容，图标，文本等等
3. 获取一个 notificationManager ，这个